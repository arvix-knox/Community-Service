

```markdown
# üèòÔ∏è Community Service ‚Äî Production-Ready Microservice

<div align="center">

![Python](https://img.shields.io/badge/Python-3.12-blue?logo=python)
![FastAPI](https://img.shields.io/badge/FastAPI-0.115-green?logo=fastapi)
![PostgreSQL](https://img.shields.io/badge/PostgreSQL-16-blue?logo=postgresql)
![Redis](https://img.shields.io/badge/Redis-7-red?logo=redis)
![Kafka](https://img.shields.io/badge/Kafka-3.7-black?logo=apachekafka)
![Docker](https://img.shields.io/badge/Docker-Compose-blue?logo=docker)
![License](https://img.shields.io/badge/License-MIT-yellow)

**–ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π –∞–≤—Ç–æ–Ω–æ–º–Ω—ã–π –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ–æ–±—â–µ—Å—Ç–≤–∞–º–∏, —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏, –ø–æ—Å—Ç–∞–º–∏, —Å–æ–±—ã—Ç–∏—è–º–∏, –ø–æ–¥–ø–∏—Å–∫–∞–º–∏ –∏ –¥–æ–Ω–∞—Ç–∞–º–∏.**

</div>

---

## üìã –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

- [–û–±–∑–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞](#-–æ–±–∑–æ—Ä-–ø—Ä–æ–µ–∫—Ç–∞)
- [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](#-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
- [–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫](#-—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π-—Å—Ç–µ–∫)
- [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞](#-—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–ø—Ä–æ–µ–∫—Ç–∞)
- [–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç](#-–±—ã—Å—Ç—Ä—ã–π-—Å—Ç–∞—Ä—Ç)
- [–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è](#-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)
- [API Reference](#-api-reference)
- [–ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö](#-–º–æ–¥–µ–ª–∏-–¥–∞–Ω–Ω—ã—Ö)
- [Event System](#-event-system)
- [–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ](#-–∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ)
- [–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å](#-–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å)
- [–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ](#-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
- [–î–µ–ø–ª–æ–π –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ](#-–¥–µ–ø–ª–æ–π-–∏-–º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ)
- [–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥](#-–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥)
- [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è ‚Äî –ø–æ—á–µ–º—É —Ç–∞–∫](#-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ-—Ä–µ—à–µ–Ω–∏—è--–ø–æ—á–µ–º—É-—Ç–∞–∫)
- [–ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∑–Ω–∞–Ω–∏—è](#-–Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ-–∑–Ω–∞–Ω–∏—è)
- [FAQ](#-faq)
- [Contributing](#-contributing)

---

## üîç –û–±–∑–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞

Community Service ‚Äî —ç—Ç–æ **–∞–≤—Ç–æ–Ω–æ–º–Ω—ã–π REST API –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å**, –æ—Ç–≤–µ—á–∞—é—â–∏–π –∑–∞ –≤–µ—Å—å
–∂–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª —Å–æ–æ–±—â–µ—Å—Ç–≤ –≤ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ:

| –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|---|
| **–°–æ–æ–±—â–µ—Å—Ç–≤–∞** | CRUD, –ø–æ–∏—Å–∫, —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è, –ø—É–±–ª–∏—á–Ω—ã–µ/–ø—Ä–∏–≤–∞—Ç–Ω—ã–µ/–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–µ |
| **–£—á–∞—Å—Ç–Ω–∏–∫–∏** | –í—Å—Ç—É–ø–ª–µ–Ω–∏–µ, –≤—ã—Ö–æ–¥, –±–∞–Ω, –º—É—Ç, –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Ä–æ–ª–µ–π |
| **–†–æ–ª–∏ –∏ –ø—Ä–∞–≤–∞** | –ì–∏–±–∫–∞—è RBAC-—Å–∏—Å—Ç–µ–º–∞ —Å –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ–º –ø—Ä–∞–≤ |
| **–ü–æ—Å—Ç—ã** | –ü—É–±–ª–∏–∫–∞—Ü–∏—è, –º–æ–¥–µ—Ä–∞—Ü–∏—è, –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–∏–µ, –º–µ–¥–∏–∞-–≤–ª–æ–∂–µ–Ω–∏—è |
| **–ö–∞–Ω–∞–ª—ã** | –¢–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∫–∞–Ω–∞–ª—ã –≤–Ω—É—Ç—Ä–∏ —Å–æ–æ–±—â–µ—Å—Ç–≤–∞ |
| **–°–æ–±—ã—Ç–∏—è** | –ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è —Å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ |
| **–ü–æ–¥–ø–∏—Å–∫–∏** | –£—Ä–æ–≤–Ω–∏ –ø–æ–¥–ø–∏—Å–∫–∏ —Å —Ç–∞—Ä–∏—Ñ–∏–∫–∞—Ü–∏–µ–π |
| **–î–æ–Ω–∞—Ç—ã** | –ü—Ä–∏—ë–º –ø–æ–∂–µ—Ä—Ç–≤–æ–≤–∞–Ω–∏–π —Å –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π |
| **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞** | –î–∞—à–±–æ—Ä–¥ –ø–æ —Å–æ–æ–±—â–µ—Å—Ç–≤—É, –ø–æ—Å—Ç–∞–º, —É—á–∞—Å—Ç–Ω–∏–∫–∞–º |

### –ö–ª—é—á–µ–≤—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏

- ‚úÖ **Production-ready** ‚Äî –Ω–µ —É—á–µ–±–Ω—ã–π –ø—Ä–æ–µ–∫—Ç, –∞ —Ä–µ–∞–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- ‚úÖ **–ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ** ‚Äî stateless, –∑–∞ Nginx –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫–æ–º
- ‚úÖ **Event-driven** ‚Äî –ø—É–±–ª–∏–∫–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏–π –≤ Kafka –∏–ª–∏ RabbitMQ
- ‚úÖ **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ** ‚Äî Redis –¥–ª—è –≥–æ—Ä—è—á–∏—Ö –¥–∞–Ω–Ω—ã—Ö, <200ms –Ω–∞ —á—Ç–µ–Ω–∏–µ
- ‚úÖ **RBAC** ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –Ω–∞ –∫–∞–∂–¥–æ–º –∑–∞—â–∏—â—ë–Ω–Ω–æ–º —ç–Ω–¥–ø–æ–∏–Ω—Ç–µ
- ‚úÖ **Structured Logging** ‚Äî JSON-–ª–æ–≥–∏ –¥–ª—è ELK/Loki/CloudWatch
- ‚úÖ **Graceful degradation** ‚Äî Redis/Kafka –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã ‚Üí —Å–µ—Ä–≤–∏—Å –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### Clean Architecture (–°–ª–æ–∏—Å—Ç–∞—è)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                      üåê API Layer                           ‚îÇ
‚îÇ  FastAPI Routers ‚Üí Middleware ‚Üí Dependencies                ‚îÇ
‚îÇ  –í–∞–ª–∏–¥–∞—Ü–∏—è, –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è, —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è                     ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                    ‚öôÔ∏è Service Layer                          ‚îÇ
‚îÇ  –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞, –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è, —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏                     ‚îÇ
‚îÇ  CommunityService, MemberService, PostService...            ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                    üì¶ Domain Layer                           ‚îÇ
‚îÇ  SQLAlchemy –º–æ–¥–µ–ª–∏, Enums, –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞                   ‚îÇ
‚îÇ  Community, Member, Post, Role, Event...                    ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                  üíæ Repository Layer                         ‚îÇ
‚îÇ  –ê–±—Å—Ç—Ä–∞–∫—Ü–∏—è –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º, SQL-–∑–∞–ø—Ä–æ—Å—ã                   ‚îÇ
‚îÇ  BaseRepository ‚Üí CommunityRepo, MemberRepo...             ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                üîß Infrastructure Layer                      ‚îÇ
‚îÇ  Redis, Kafka/RabbitMQ, S3/MinIO, DI Container             ‚îÇ
‚îÇ  –í–Ω–µ—à–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏, –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—Ç –ª–æ–≥–∏–∫–∏               ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö (Request ‚Üí Response)

```
Client
  ‚îÇ
  ‚ñº
Nginx (Load Balancer)
  ‚îÇ
  ‚ñº
FastAPI (Middleware: JWT ‚Üí Logging)
  ‚îÇ
  ‚ñº
Router (–í–∞–ª–∏–¥–∞—Ü–∏—è Pydantic)
  ‚îÇ
  ‚ñº
Dependency Injection (Container ‚Üí Session ‚Üí Repos)
  ‚îÇ
  ‚ñº
Service (–ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞)
  ‚îÇ
  ‚îú‚îÄ‚îÄ‚ñ∂ Repository ‚Üí PostgreSQL
  ‚îú‚îÄ‚îÄ‚ñ∂ Redis Cache (read/invalidate)
  ‚îú‚îÄ‚îÄ‚ñ∂ Event Publisher ‚Üí Kafka/RabbitMQ
  ‚îÇ
  ‚ñº
Pydantic Response ‚Üí JSON ‚Üí Client
```

### –°—Ö–µ–º–∞ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ    Nginx     ‚îÇ :80
                    ‚îÇ  (LB/Proxy) ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚îÇ
              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
              ‚îÇ            ‚îÇ            ‚îÇ
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ  App :8000 ‚îÇ ‚îÇ App :8000‚îÇ ‚îÇApp :8000‚îÇ  ‚Üê –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ
        ‚îÇ (Worker 1) ‚îÇ ‚îÇ(Worker 2)‚îÇ ‚îÇ(Worker 3)‚îÇ    –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ
        ‚îî‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îò
           ‚îÇ  ‚îÇ  ‚îÇ        ‚îÇ  ‚îÇ        ‚îÇ  ‚îÇ
     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
     ‚îÇ        ‚îÇ              ‚îÇ  ‚îÇ         ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚î¥‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îê
‚îÇPostgres‚îÇ ‚îÇRedis ‚îÇ    ‚îÇ Kafka  ‚îÇ   ‚îÇ MinIO  ‚îÇ
‚îÇ  :5432 ‚îÇ ‚îÇ:6379 ‚îÇ    ‚îÇ :9092  ‚îÇ   ‚îÇ :9000  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üõ†Ô∏è –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

### Backend

| –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è | –í–µ—Ä—Å–∏—è | –î–ª—è —á–µ–≥–æ |
|---|---|---|
| **Python** | 3.12 | –û—Å–Ω–æ–≤–Ω–æ–π —è–∑—ã–∫ |
| **FastAPI** | 0.115 | Async REST framework |
| **Pydantic v2** | 2.10 | –í–∞–ª–∏–¥–∞—Ü–∏—è, —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è, –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ |
| **SQLAlchemy 2.0** | 2.0.36 | Async ORM |
| **asyncpg** | 0.30 | Async PostgreSQL –¥—Ä–∞–π–≤–µ—Ä |
| **Alembic** | 1.14 | –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î |
| **PyJWT** | 2.10 | JWT-—Ç–æ–∫–µ–Ω—ã |
| **Uvicorn** | 0.34 | ASGI-—Å–µ—Ä–≤–µ—Ä |
| **Gunicorn** | 23.0 | Process manager |

### –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞

| –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è | –í–µ—Ä—Å–∏—è | –î–ª—è —á–µ–≥–æ |
|---|---|---|
| **PostgreSQL** | 16 | –û—Å–Ω–æ–≤–Ω–∞—è –ë–î |
| **Redis** | 7 | –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ |
| **Apache Kafka** | 3.7 | Event streaming |
| **RabbitMQ** | 3.13 | –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π message broker |
| **MinIO** | latest | S3-—Å–æ–≤–º–µ—Å—Ç–∏–º–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –º–µ–¥–∏–∞ |
| **Nginx** | alpine | Reverse proxy + Load balancer |
| **Docker** | 24+ | –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è |

### –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

| –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç | –î–ª—è —á–µ–≥–æ |
|---|---|
| **pytest** + **pytest-asyncio** | –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ |
| **httpx** | Async HTTP –∫–ª–∏–µ–Ω—Ç –¥–ª—è —Ç–µ—Å—Ç–æ–≤ |
| **docker-compose** | –û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Å—Ä–µ–¥—ã |

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
community-service/
‚îÇ
‚îú‚îÄ‚îÄ main.py                          # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞, —Ñ–∞–±—Ä–∏–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ requirements.txt                 # Python-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ alembic.ini                      # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –º–∏–≥—Ä–∞—Ü–∏–π
‚îú‚îÄ‚îÄ Dockerfile                       # Multi-stage —Å–±–æ—Ä–∫–∞
‚îú‚îÄ‚îÄ docker-compose.yml               # –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ü–µ–ª–∏–∫–æ–º
‚îú‚îÄ‚îÄ .env                             # –õ–æ–∫–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ .env.example                     # –®–∞–±–ª–æ–Ω –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
‚îÇ
‚îú‚îÄ‚îÄ app/                             # –û—Å–Ω–æ–≤–Ω–æ–π –ø–∞–∫–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ core/                        # –Ø–¥—Ä–æ: –∫–æ–Ω—Ñ–∏–≥, –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å, –æ—à–∏–±–∫–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config.py                # Pydantic Settings –∏–∑ env
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ security.py              # JWT –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ, UserContext
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ rbac.py                  # RBAC Permission checker
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ exceptions.py            # –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ logging.py               # JSON structured logging
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ domain/                      # –î–æ–º–µ–Ω–Ω—ã–π —Å–ª–æ–π
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ models.py                # SQLAlchemy 2.0 –º–æ–¥–µ–ª–∏ (9 —Ç–∞–±–ª–∏—Ü)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ enums.py                 # –ü–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ schemas/                     # Pydantic DTO
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ common.py                # Pagination, MessageResponse
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ community.py             # CommunityCreate/Update/Response
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ member.py                # MemberCreate/Update/Response
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ role.py                  # RoleCreate/Update/Response
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ post.py                  # PostCreate/Update/Response
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ channel.py               # ChannelCreate/Update/Response
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ event.py                 # EventCreate/Update/Response
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ subscription.py          # SubscriptionLevel + Subscription
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ donation.py              # DonationCreate/Response
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ analytics.py             # –ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ DTO
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ repositories/                # –°–ª–æ–π –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ base.py                  # –ë–∞–∑–æ–≤—ã–π CRUD-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π (Generic)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ community_repo.py        # + –ø–æ–∏—Å–∫, slug, popular
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ member_repo.py           # + assign_role, count_active
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ role_repo.py             # + get_default_role
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ post_repo.py             # + —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –∫–∞–Ω–∞–ª—É
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ channel_repo.py          # + —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ position
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ event_repo.py            # + —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Å—Ç–∞—Ç—É—Å—É
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ subscription_repo.py     # + —É—Ä–æ–≤–Ω–∏ –ø–æ–¥–ø–∏—Å–æ–∫
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ donation_repo.py         # + top_donors, aggregates
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ services/                    # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ community_service.py     # –°–æ–∑–¥–∞–Ω–∏–µ + owner + default role/channel
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ member_service.py        # Join/leave + —Ä–æ–ª–∏ + —Å—á—ë—Ç—á–∏–∫–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ role_service.py          # CRUD —Ä–æ–ª–µ–π + –∫—ç—à
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ post_service.py          # –ü—É–±–ª–∏–∫–∞—Ü–∏—è + –º–æ–¥–µ—Ä–∞—Ü–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ channel_service.py       # –ö–∞–Ω–∞–ª—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ event_service.py         # –ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ subscription_service.py  # –£—Ä–æ–≤–Ω–∏ –ø–æ–¥–ø–∏—Å–æ–∫ + –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ donation_service.py      # –ü—Ä–∏—ë–º –¥–æ–Ω–∞—Ç–æ–≤ + top donors
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ analytics_service.py     # –ê–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ api/                         # HTTP-—Å–ª–æ–π
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ middleware.py             # JWT Middleware + Request Logging
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ deps.py                  # FastAPI Dependencies
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ v1/                      # API –≤–µ—Ä—Å–∏—è 1
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ router.py            # –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π —Ä–æ—É—Ç–µ—Ä
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ communities.py       # 5 endpoints
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ members.py           # 4 endpoints
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ roles.py             # 4 endpoints
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ posts.py             # 5 endpoints
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ channels.py          # 4 endpoints
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ events.py            # 5 endpoints
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ subscriptions.py     # 2 endpoints
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ donations.py         # 2 endpoints
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ analytics.py         # 3 endpoints
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ events/                      # Event Publishing
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ base.py                  # –ê–±—Å—Ç—Ä–∞–∫—Ü–∏—è EventPublisher
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ event_types.py           # 14 —Ç–∏–ø–æ–≤ —Å–æ–±—ã—Ç–∏–π
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ kafka_publisher.py       # –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è Kafka
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ rabbitmq_publisher.py    # –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è RabbitMQ
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ publisher.py             # –§–∞–±—Ä–∏–∫–∞ (–≤—ã–±–æ—Ä –ø–æ –∫–æ–Ω—Ñ–∏–≥—É)
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ infrastructure/              # –í–Ω–µ—à–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ container.py             # DI-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ cache/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ redis_client.py      # Async Redis wrapper
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ cache_keys.py        # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–µ–π –∫—ç—à–∞
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ media/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ s3_client.py         # S3/MinIO –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—è
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ db/
‚îÇ       ‚îî‚îÄ‚îÄ session.py               # AsyncEngine + SessionFactory
‚îÇ
‚îú‚îÄ‚îÄ migrations/                      # Alembic
‚îÇ   ‚îú‚îÄ‚îÄ env.py                       # Async Alembic env
‚îÇ   ‚îú‚îÄ‚îÄ script.py.mako               # –®–∞–±–ª–æ–Ω –º–∏–≥—Ä–∞—Ü–∏–∏
‚îÇ   ‚îî‚îÄ‚îÄ versions/                    # –§–∞–π–ª—ã –º–∏–≥—Ä–∞—Ü–∏–π
‚îÇ
‚îú‚îÄ‚îÄ docker/
‚îÇ   ‚îú‚îÄ‚îÄ entrypoint.sh                # –ú–∏–≥—Ä–∞—Ü–∏–∏ ‚Üí Gunicorn
‚îÇ   ‚îî‚îÄ‚îÄ nginx.conf                   # Reverse proxy –∫–æ–Ω—Ñ–∏–≥
‚îÇ
‚îî‚îÄ‚îÄ tests/
    ‚îú‚îÄ‚îÄ conftest.py                  # –§–∏–∫—Å—Ç—É—Ä—ã, —Ñ–∞–±—Ä–∏–∫–∞ JWT
    ‚îî‚îÄ‚îÄ test_health.py               # Smoke-—Ç–µ—Å—Ç
```

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –í–∞—Ä–∏–∞–Ω—Ç 1: Docker (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
# 1. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø—Ä–æ–µ–∫—Ç
python generate_project.py

# 2. –ó–∞—Ö–æ–¥–∏–º –≤ –ø—Ä–æ–µ–∫—Ç
cd community-service

# 3. –ó–∞–ø—É—Å–∫–∞–µ–º –í–°–Å –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π
docker-compose up --build -d

# 4. –ü—Ä–æ–≤–µ—Ä—è–µ–º
curl http://localhost:8000/health
# ‚Üí {"status":"healthy","service":"community-service","version":"1.0.0"}

# 5. –û—Ç–∫—Ä—ã–≤–∞–µ–º Swagger
open http://localhost:8000/api/docs
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

```bash
# 1. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø—Ä–æ–µ–∫—Ç
python generate_project.py
cd community-service

# 2. –í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
python -m venv venv
source venv/bin/activate  # Linux/Mac
# venv\Scripts\activate   # Windows

# 3. –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -r requirements.txt

# 4. –ü–æ–¥–Ω–∏–º–∞–µ–º –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É (–ë–î + Redis)
docker-compose up -d postgres redis

# 5. –ü—Ä–∏–º–µ–Ω—è–µ–º –º–∏–≥—Ä–∞—Ü–∏–∏
alembic revision --autogenerate -m "initial tables"
alembic upgrade head

# 6. –ó–∞–ø—É—Å–∫–∞–µ–º
python main.py

# –°–µ—Ä–≤–∏—Å –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ http://localhost:8000
# Swagger: http://localhost:8000/api/docs (—Ç–æ–ª—å–∫–æ –ø—Ä–∏ DEBUG=true)
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: –¢–æ–ª—å–∫–æ PostgreSQL –∏ Redis –±–µ–∑ Docker

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ PostgreSQL 16 –∏ Redis 7 –≤—Ä—É—á–Ω—É—é

# –°–æ–∑–¥–∞–π—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
createdb community_db

# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env
DATABASE_URL=postgresql+asyncpg://your_user:your_pass@localhost:5432/community_db
REDIS_URL=redis://localhost:6379/0

# –î–∞–ª–µ–µ –∫–∞–∫ –≤ –≤–∞—Ä–∏–∞–Ω—Ç–µ 2
```

---

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–í—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –±–µ—Ä—É—Ç—Å—è –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è (`.env` —Ñ–∞–π–ª):

### –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|---|---|
| `APP_NAME` | community-service | –ò–º—è —Å–µ—Ä–≤–∏—Å–∞ |
| `APP_PORT` | 8000 | –ü–æ—Ä—Ç |
| `DEBUG` | false | –†–µ–∂–∏–º –æ—Ç–ª–∞–¥–∫–∏ (–≤–∫–ª—é—á–∞–µ—Ç Swagger) |
| `WORKERS_COUNT` | 4 | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ Gunicorn workers |

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|---|---|
| `DATABASE_URL` | postgresql+asyncpg://... | Connection string |
| `DB_POOL_SIZE` | 20 | –†–∞–∑–º–µ—Ä –ø—É–ª–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π |
| `DB_MAX_OVERFLOW` | 10 | –î–æ–ø. —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å–≤–µ—Ä—Ö –ø—É–ª–∞ |
| `DB_POOL_RECYCLE` | 3600 | –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π (—Å–µ–∫) |

### Redis

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|---|---|
| `REDIS_URL` | redis://localhost:6379/0 | Connection string |
| `CACHE_DEFAULT_TTL` | 300 | TTL –∫—ç—à–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (—Å–µ–∫) |
| `CACHE_ANALYTICS_TTL` | 600 | TTL –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ |

### JWT

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|---|---|
| `JWT_SECRET_KEY` | change-me | –°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á |
| `JWT_ALGORITHM` | HS256 | –ê–ª–≥–æ—Ä–∏—Ç–º –ø–æ–¥–ø–∏—Å–∏ |

### Event Broker

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|---|---|
| `EVENT_BROKER_TYPE` | kafka | `kafka` –∏–ª–∏ `rabbitmq` |
| `KAFKA_BOOTSTRAP_SERVERS` | localhost:9092 | –°–µ—Ä–≤–µ—Ä—ã Kafka |
| `RABBITMQ_URL` | amqp://guest:guest@... | URL RabbitMQ |

### S3 / MinIO

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|---|---|
| `S3_ENDPOINT` | http://localhost:9000 | Endpoint |
| `S3_ACCESS_KEY` | minioadmin | –ö–ª—é—á –¥–æ—Å—Ç—É–ø–∞ |
| `S3_SECRET_KEY` | minioadmin | –°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á |
| `S3_BUCKET` | community-media | –ò–º—è –±–∞–∫–µ—Ç–∞ |

---

## üì° API Reference

### –ë–∞–∑–æ–≤—ã–π URL

```
http://localhost:8000/api/v1
```

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

–í—Å–µ –∑–∞—â–∏—â—ë–Ω–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã —Ç—Ä–µ–±—É—é—Ç JWT-—Ç–æ–∫–µ–Ω –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ:

```
Authorization: Bearer <jwt_token>
```

–°—Ç—Ä—É–∫—Ç—É—Ä–∞ JWT payload:
```json
{
  "sub": "550e8400-e29b-41d4-a716-446655440000",
  "email": "user@example.com",
  "roles": ["admin"],
  "permissions": ["community.create", "post.create"],
  "is_superadmin": false
}
```

### Communities (–°–æ–æ–±—â–µ—Å—Ç–≤–∞)

| –ú–µ—Ç–æ–¥ | –ü—É—Ç—å | –û–ø–∏—Å–∞–Ω–∏–µ | –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è |
|---|---|---|---|
| `GET` | `/communities` | –°–ø–∏—Å–æ–∫ —Å–æ–æ–±—â–µ—Å—Ç–≤ | ‚ùå |
| `GET` | `/communities/{id}` | –ü–æ–ª—É—á–∏—Ç—å —Å–æ–æ–±—â–µ—Å—Ç–≤–æ | ‚ùå |
| `POST` | `/communities` | –°–æ–∑–¥–∞—Ç—å —Å–æ–æ–±—â–µ—Å—Ç–≤–æ | ‚úÖ |
| `PUT` | `/communities/{id}` | –û–±–Ω–æ–≤–∏—Ç—å | ‚úÖ (owner) |
| `DELETE` | `/communities/{id}` | –£–¥–∞–ª–∏—Ç—å | ‚úÖ (owner) |

<details>
<summary>üìù –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤</summary>

**–°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–æ–±—â–µ—Å—Ç–≤–∞:**
```bash
curl -X POST http://localhost:8000/api/v1/communities \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "Python Developers",
    "description": "–°–æ–æ–±—â–µ—Å—Ç–≤–æ Python-—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤",
    "community_type": "public"
  }'
```

**–û—Ç–≤–µ—Ç (201):**
```json
{
  "id": "550e8400-e29b-41d4-a716-446655440000",
  "name": "Python Developers",
  "slug": "python-developers-a1b2c3d4",
  "description": "–°–æ–æ–±—â–µ—Å—Ç–≤–æ Python-—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤",
  "community_type": "public",
  "status": "active",
  "owner_id": "...",
  "member_count": 1,
  "post_count": 0,
  "created_at": "2024-01-01T00:00:00Z",
  "updated_at": "2024-01-01T00:00:00Z"
}
```

**–°–ø–∏—Å–æ–∫ —Å –ø–æ–∏—Å–∫–æ–º:**
```bash
curl "http://localhost:8000/api/v1/communities?search=python&page=1&page_size=10"
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "items": [...],
  "total": 42,
  "page": 1,
  "page_size": 10,
  "pages": 5
}
```
</details>

### Members (–£—á–∞—Å—Ç–Ω–∏–∫–∏)

| –ú–µ—Ç–æ–¥ | –ü—É—Ç—å | –û–ø–∏—Å–∞–Ω–∏–µ | –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è |
|---|---|---|---|
| `GET` | `/communities/{id}/members` | –°–ø–∏—Å–æ–∫ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ | ‚ùå |
| `POST` | `/communities/{id}/members` | –í—Å—Ç—É–ø–∏—Ç—å | ‚úÖ |
| `PUT` | `/communities/{id}/members/{user_id}` | –û–±–Ω–æ–≤–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∞ | ‚úÖ |
| `DELETE` | `/communities/{id}/members/{user_id}` | –£–¥–∞–ª–∏—Ç—å/–≤—ã–π—Ç–∏ | ‚úÖ |

### Roles (–†–æ–ª–∏)

| –ú–µ—Ç–æ–¥ | –ü—É—Ç—å | –û–ø–∏—Å–∞–Ω–∏–µ | –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è |
|---|---|---|---|
| `GET` | `/communities/{id}/roles` | –°–ø–∏—Å–æ–∫ —Ä–æ–ª–µ–π | ‚ùå |
| `POST` | `/communities/{id}/roles` | –°–æ–∑–¥–∞—Ç—å —Ä–æ–ª—å | ‚úÖ |
| `PUT` | `/communities/{id}/roles/{role_id}` | –û–±–Ω–æ–≤–∏—Ç—å —Ä–æ–ª—å | ‚úÖ |
| `DELETE` | `/communities/{id}/roles/{role_id}` | –£–¥–∞–ª–∏—Ç—å —Ä–æ–ª—å | ‚úÖ |

### Posts (–ü–æ—Å—Ç—ã)

| –ú–µ—Ç–æ–¥ | –ü—É—Ç—å | –û–ø–∏—Å–∞–Ω–∏–µ | –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è |
|---|---|---|---|
| `GET` | `/communities/{id}/posts` | –°–ø–∏—Å–æ–∫ –ø–æ—Å—Ç–æ–≤ | ‚ùå |
| `GET` | `/posts/{id}` | –ü–æ–ª—É—á–∏—Ç—å –ø–æ—Å—Ç | ‚ùå |
| `POST` | `/communities/{id}/posts` | –°–æ–∑–¥–∞—Ç—å –ø–æ—Å—Ç | ‚úÖ |
| `PUT` | `/posts/{id}` | –û–±–Ω–æ–≤–∏—Ç—å –ø–æ—Å—Ç | ‚úÖ (author) |
| `DELETE` | `/posts/{id}` | –£–¥–∞–ª–∏—Ç—å –ø–æ—Å—Ç | ‚úÖ (author) |

### Channels (–ö–∞–Ω–∞–ª—ã)

| –ú–µ—Ç–æ–¥ | –ü—É—Ç—å | –û–ø–∏—Å–∞–Ω–∏–µ | –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è |
|---|---|---|---|
| `GET` | `/communities/{id}/channels` | –°–ø–∏—Å–æ–∫ –∫–∞–Ω–∞–ª–æ–≤ | ‚ùå |
| `POST` | `/communities/{id}/channels` | –°–æ–∑–¥–∞—Ç—å –∫–∞–Ω–∞–ª | ‚úÖ |
| `PUT` | `/channels/{id}` | –û–±–Ω–æ–≤–∏—Ç—å | ‚úÖ |
| `DELETE` | `/channels/{id}` | –£–¥–∞–ª–∏—Ç—å | ‚úÖ |

### Events (–ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è)

| –ú–µ—Ç–æ–¥ | –ü—É—Ç—å | –û–ø–∏—Å–∞–Ω–∏–µ | –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è |
|---|---|---|---|
| `GET` | `/communities/{id}/events` | –°–ø–∏—Å–æ–∫ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π | ‚ùå |
| `GET` | `/events/{id}` | –ü–æ–ª—É—á–∏—Ç—å –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ | ‚ùå |
| `POST` | `/communities/{id}/events` | –°–æ–∑–¥–∞—Ç—å | ‚úÖ |
| `PUT` | `/events/{id}` | –û–±–Ω–æ–≤–∏—Ç—å | ‚úÖ |
| `DELETE` | `/events/{id}` | –£–¥–∞–ª–∏—Ç—å | ‚úÖ |

### Subscriptions (–ü–æ–¥–ø–∏—Å–∫–∏)

| –ú–µ—Ç–æ–¥ | –ü—É—Ç—å | –û–ø–∏—Å–∞–Ω–∏–µ | –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è |
|---|---|---|---|
| `GET` | `/communities/{id}/subscriptions` | –£—Ä–æ–≤–Ω–∏ –ø–æ–¥–ø–∏—Å–æ–∫ | ‚ùå |
| `POST` | `/communities/{id}/subscriptions` | –û—Ñ–æ—Ä–º–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É | ‚úÖ |

### Donations (–î–æ–Ω–∞—Ç—ã)

| –ú–µ—Ç–æ–¥ | –ü—É—Ç—å | –û–ø–∏—Å–∞–Ω–∏–µ | –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è |
|---|---|---|---|
| `GET` | `/communities/{id}/donations` | –°–ø–∏—Å–æ–∫ –¥–æ–Ω–∞—Ç–æ–≤ | ‚ùå |
| `POST` | `/communities/{id}/donations` | –°–¥–µ–ª–∞—Ç—å –¥–æ–Ω–∞—Ç | ‚úÖ |

### Analytics (–ê–Ω–∞–ª–∏—Ç–∏–∫–∞)

| –ú–µ—Ç–æ–¥ | –ü—É—Ç—å | –û–ø–∏—Å–∞–Ω–∏–µ | –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è |
|---|---|---|---|
| `GET` | `/communities/{id}/analytics` | –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ —Å–æ–æ–±—â–µ—Å—Ç–≤–∞ | ‚úÖ |
| `GET` | `/posts/{id}/analytics` | –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø–æ—Å—Ç–∞ | ‚úÖ |
| `GET` | `/members/{id}/analytics` | –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ —É—á–∞—Å—Ç–Ω–∏–∫–∞ | ‚úÖ |

### Health Check

```
GET /health ‚Üí {"status": "healthy", "service": "community-service", "version": "1.0.0"}
```

---

## üìä –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö

### ER-–¥–∏–∞–≥—Ä–∞–º–º–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Community   ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ<‚îÇ    Member    ‚îÇ>‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ      Role        ‚îÇ
‚îÇ              ‚îÇ     ‚îÇ              ‚îÇ     ‚îÇ                  ‚îÇ
‚îÇ id (UUID PK) ‚îÇ     ‚îÇ id (UUID PK) ‚îÇ     ‚îÇ id (UUID PK)     ‚îÇ
‚îÇ name         ‚îÇ     ‚îÇ community_id ‚îÇ     ‚îÇ community_id     ‚îÇ
‚îÇ slug (unique)‚îÇ     ‚îÇ user_id      ‚îÇ     ‚îÇ name             ‚îÇ
‚îÇ description  ‚îÇ     ‚îÇ status       ‚îÇ     ‚îÇ permissions_list ‚îÇ
‚îÇ type         ‚îÇ     ‚îÇ is_owner     ‚îÇ     ‚îÇ is_default       ‚îÇ
‚îÇ status       ‚îÇ     ‚îÇ nickname     ‚îÇ     ‚îÇ priority         ‚îÇ
‚îÇ owner_id     ‚îÇ     ‚îÇ joined_at    ‚îÇ     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
‚îÇ member_count ‚îÇ     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò              ‚îÇ
‚îÇ post_count   ‚îÇ            ‚îÇ                      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
       ‚îÇ             ‚îÇ member_roles ‚îÇ     ‚îÇ   (M2M table)   ‚îÇ
       ‚îÇ             ‚îÇ  member_id   ‚îÇ     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ             ‚îÇ  role_id     ‚îÇ
       ‚îÇ             ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚îú‚îÄ‚îÄ‚îÄ‚îÄ<‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
       ‚îÇ     ‚îÇ    Post      ‚îÇ
       ‚îÇ     ‚îÇ id (UUID PK) ‚îÇ
       ‚îÇ     ‚îÇ community_id ‚îÇ
       ‚îÇ     ‚îÇ channel_id   ‚îÇ
       ‚îÇ     ‚îÇ author_id    ‚îÇ
       ‚îÇ     ‚îÇ title        ‚îÇ
       ‚îÇ     ‚îÇ content      ‚îÇ
       ‚îÇ     ‚îÇ status       ‚îÇ
       ‚îÇ     ‚îÇ is_pinned    ‚îÇ
       ‚îÇ     ‚îÇ media_urls[] ‚îÇ
       ‚îÇ     ‚îÇ like_count   ‚îÇ
       ‚îÇ     ‚îÇ view_count   ‚îÇ
       ‚îÇ     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚îú‚îÄ‚îÄ‚îÄ‚îÄ<‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
       ‚îÇ     ‚îÇ   Channel    ‚îÇ
       ‚îÇ     ‚îÇ id (UUID PK) ‚îÇ
       ‚îÇ     ‚îÇ community_id ‚îÇ
       ‚îÇ     ‚îÇ name         ‚îÇ
       ‚îÇ     ‚îÇ type         ‚îÇ
       ‚îÇ     ‚îÇ position     ‚îÇ
       ‚îÇ     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚îú‚îÄ‚îÄ‚îÄ‚îÄ<‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
       ‚îÇ     ‚îÇ    Event     ‚îÇ
       ‚îÇ     ‚îÇ id (UUID PK) ‚îÇ
       ‚îÇ     ‚îÇ community_id ‚îÇ
       ‚îÇ     ‚îÇ creator_id   ‚îÇ
       ‚îÇ     ‚îÇ title        ‚îÇ
       ‚îÇ     ‚îÇ starts_at    ‚îÇ
       ‚îÇ     ‚îÇ ends_at      ‚îÇ
       ‚îÇ     ‚îÇ status       ‚îÇ
       ‚îÇ     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚îú‚îÄ‚îÄ‚îÄ‚îÄ<‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
       ‚îÇ     ‚îÇSubscriptionLevel ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ<‚îÇ  Subscription    ‚îÇ
       ‚îÇ     ‚îÇ id (UUID PK)      ‚îÇ     ‚îÇ id (UUID PK)     ‚îÇ
       ‚îÇ     ‚îÇ community_id      ‚îÇ     ‚îÇ level_id         ‚îÇ
       ‚îÇ     ‚îÇ name              ‚îÇ     ‚îÇ user_id          ‚îÇ
       ‚îÇ     ‚îÇ price             ‚îÇ     ‚îÇ community_id     ‚îÇ
       ‚îÇ     ‚îÇ duration_days     ‚îÇ     ‚îÇ status           ‚îÇ
       ‚îÇ     ‚îÇ features          ‚îÇ     ‚îÇ starts_at        ‚îÇ
       ‚îÇ     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îÇ expires_at       ‚îÇ
       ‚îÇ                               ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ<‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
             ‚îÇ   Donation   ‚îÇ
             ‚îÇ id (UUID PK) ‚îÇ
             ‚îÇ community_id ‚îÇ
             ‚îÇ donor_id     ‚îÇ
             ‚îÇ amount       ‚îÇ
             ‚îÇ currency     ‚îÇ
             ‚îÇ message      ‚îÇ
             ‚îÇ status       ‚îÇ
             ‚îÇ is_anonymous ‚îÇ
             ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ò–Ω–¥–µ–∫—Å—ã

–ö–∞–∂–¥–∞—è —Ç–∞–±–ª–∏—Ü–∞ –∏–º–µ–µ—Ç –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã:

```sql
-- –ë—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫ —Å–æ–æ–±—â–µ—Å—Ç–≤
idx_communities_status (status)
idx_communities_type_status (community_type, status)

-- –ë—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
idx_members_community_status (community_id, status)
idx_members_user (user_id)
uq_member_community_user (community_id, user_id) UNIQUE

-- –ë—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫ –ø–æ—Å—Ç–æ–≤
idx_posts_community_status (community_id, status)
idx_posts_community_pinned (community_id, is_pinned)
idx_posts_published (published_at)

-- –ò —Ç.–¥. –¥–ª—è –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü
```

---

## üì® Event System

### –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Å–æ–±—ã—Ç–∏—è

| –°–æ–±—ã—Ç–∏–µ | –ö–æ–≥–¥–∞ –ø—É–±–ª–∏–∫—É–µ—Ç—Å—è |
|---|---|
| `community.created` | –°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–æ–±—â–µ—Å—Ç–≤–∞ |
| `community.updated` | –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ |
| `community.deleted` | –£–¥–∞–ª–µ–Ω–∏–µ |
| `member.joined` | –í—Å—Ç—É–ø–ª–µ–Ω–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–∞ |
| `member.left` | –í—ã—Ö–æ–¥/—É–¥–∞–ª–µ–Ω–∏–µ |
| `post.created` | –ü—É–±–ª–∏–∫–∞—Ü–∏—è –ø–æ—Å—Ç–∞ |
| `post.updated` | –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ |
| `post.deleted` | –£–¥–∞–ª–µ–Ω–∏–µ |
| `donation.received` | –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–æ–Ω–∞—Ç–∞ |
| `subscription.started` | –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏ |
| `subscription.ended` | –û–∫–æ–Ω—á–∞–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏ |
| `event.created` | –°–æ–∑–¥–∞–Ω–∏–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è |
| `event.updated` | –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ |
| `event.deleted` | –£–¥–∞–ª–µ–Ω–∏–µ |

### –§–æ—Ä–º–∞—Ç —Å–æ–±—ã—Ç–∏—è

```json
{
  "event_id": "550e8400-e29b-41d4-a716-446655440000",
  "event_type": "community.created",
  "timestamp": "2024-01-01T12:00:00Z",
  "service": "community-service",
  "payload": {
    "community_id": "...",
    "owner_id": "...",
    "name": "Python Developers"
  },
  "metadata": {}
}
```

### –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É Kafka –∏ RabbitMQ

```env
# –ò—Å–ø–æ–ª—å–∑—É–µ–º Kafka
EVENT_BROKER_TYPE=kafka

# –ò–õ–ò –∏—Å–ø–æ–ª—å–∑—É–µ–º RabbitMQ
EVENT_BROKER_TYPE=rabbitmq
```

–ê–±—Å—Ç—Ä–∞–∫—Ü–∏—è `EventPublisher` ‚Üí —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ `KafkaEventPublisher` –∏
`RabbitMQEventPublisher`. –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –æ–¥–Ω–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π, –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–¥–∞.

### Graceful Degradation

–ï—Å–ª–∏ Kafka/RabbitMQ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã, publisher —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ **stub-—Ä–µ–∂–∏–º–µ**:
- –õ–æ–≥–∏—Ä—É–µ—Ç —Å–æ–±—ã—Ç–∏—è –≤ stdout
- –ù–µ –±—Ä–æ—Å–∞–µ—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏—è
- –°–µ—Ä–≤–∏—Å –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å

---

## üí® –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ

### –°—Ç—Ä–∞—Ç–µ–≥–∏—è

- **Cache-Aside (Lazy Loading)** ‚Äî –¥–∞–Ω–Ω—ã–µ –∫—ç—à–∏—Ä—É—é—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–º —á—Ç–µ–Ω–∏–∏
- **Invalidation on Write** ‚Äî –∫—ç—à –∏–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ –∑–∞–ø–∏—Å–∏
- **Pattern-based Invalidation** ‚Äî —É–¥–∞–ª–µ–Ω–∏–µ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –∫–ª—é—á–µ–π –ø–æ –º–∞—Å–∫–µ

### –ß—Ç–æ –∫—ç—à–∏—Ä—É–µ—Ç—Å—è

| –î–∞–Ω–Ω—ã–µ | TTL | –ö–ª—é—á |
|---|---|---|
| –°–æ–æ–±—â–µ—Å—Ç–≤–æ –ø–æ ID | 5 –º–∏–Ω | `community:{id}` |
| –°–ø–∏—Å–æ–∫ —Å–æ–æ–±—â–µ—Å—Ç–≤ | 5 –º–∏–Ω | `communities:list:{page}:{size}` |
| –†–æ–ª–∏ —Å–æ–æ–±—â–µ—Å—Ç–≤–∞ | 5 –º–∏–Ω | `community:{id}:roles` |
| –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ —Å–æ–æ–±—â–µ—Å—Ç–≤–∞ | 10 –º–∏–Ω | `community:{id}:analytics` |
| –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø–æ—Å—Ç–∞ | 10 –º–∏–Ω | `post:{id}:analytics` |
| Top donors | 5 –º–∏–Ω | `community:{id}:top_donors` |

### Graceful Degradation

–ï—Å–ª–∏ Redis –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω:
- –í—Å–µ –º–µ—Ç–æ–¥—ã `RedisClient` –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç `None`
- –ó–∞–ø—Ä–æ—Å—ã –∏–¥—É—Ç –Ω–∞–ø—Ä—è–º—É—é –≤ PostgreSQL
- –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–Ω–∏–∂–∞–µ—Ç—Å—è, –Ω–æ —Å–µ—Ä–≤–∏—Å —Ä–∞–±–æ—Ç–∞–µ—Ç

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### JWT-–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

```
Request ‚Üí JWTMiddleware ‚Üí Decode Token ‚Üí request.state.user
                                              ‚îÇ
                                   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                                   ‚îÇ    UserContext       ‚îÇ
                                   ‚îÇ  user_id: UUID      ‚îÇ
                                   ‚îÇ  email: str         ‚îÇ
                                   ‚îÇ  roles: list[str]   ‚îÇ
                                   ‚îÇ  permissions: list  ‚îÇ
                                   ‚îÇ  is_superadmin: bool‚îÇ
                                   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### RBAC (Role-Based Access Control)

17 —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π, —Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ —Ä–µ—Å—É—Ä—Å–∞–º:

```python
Permission.COMMUNITY_CREATE   # community.create
Permission.COMMUNITY_UPDATE   # community.update
Permission.COMMUNITY_DELETE   # community.delete
Permission.MEMBER_MANAGE      # member.manage
Permission.MEMBER_KICK        # member.kick
Permission.ROLE_MANAGE        # role.manage
Permission.POST_CREATE        # post.create
Permission.POST_UPDATE        # post.update
Permission.POST_DELETE        # post.delete
Permission.POST_MODERATE      # post.moderate
Permission.CHANNEL_MANAGE     # channel.manage
Permission.EVENT_MANAGE       # event.manage
Permission.ANALYTICS_VIEW     # analytics.view
# ... –∏ –¥—Ä—É–≥–∏–µ
```

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤

1. JWT middleware –∏–∑–≤–ª–µ–∫–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
2. `RBACChecker` –ø–æ–ª—É—á–∞–µ—Ç `community_id` –∏–∑ URL
3. –ò—â–µ—Ç `Member` –≤ –ë–î –¥–ª—è –ø–∞—Ä—ã (user_id, community_id)
4. –°–æ–±–∏—Ä–∞–µ—Ç –≤—Å–µ `permissions_list` –∏–∑ –≤—Å–µ—Ö —Ä–æ–ª–µ–π —É—á–∞—Å—Ç–Ω–∏–∫–∞
5. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ —Ç—Ä–µ–±—É–µ–º—ã—Ö —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π
6. **–í–ª–∞–¥–µ–ª–µ—Ü** (`is_owner=True`) –ø–æ–ª—É—á–∞–µ—Ç **–≤—Å–µ** —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
7. **–°—É–ø–µ—Ä–∞–¥–º–∏–Ω** (`is_superadmin=True`) –æ–±—Ö–æ–¥–∏—Ç –≤—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏

### –ó–∞—â–∏—Ç–∞ –æ—Ç –∏–Ω—ä–µ–∫—Ü–∏–π

- Pydantic v2 –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç **–≤—Å–µ** –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- SQLAlchemy –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **–ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã** (–Ω–µ—Ç SQL-–∏–Ω—ä–µ–∫—Ü–∏–π)
- `Field(max_length=...)` –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç –¥–ª–∏–Ω—É –ø–æ–ª–µ–π
- Slug –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è —Ä–µ–≥—É–ª—è—Ä–∫–æ–π: `^[a-z0-9][a-z0-9\-]{0,253}[a-z0-9]$`

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

```bash
# –í—Å–µ —Ç–µ—Å—Ç—ã
pytest tests/ -v

# –° –ø–æ–∫—Ä—ã—Ç–∏–µ–º
pytest tests/ --cov=app --cov-report=html

# –¢–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ñ–∞–π–ª
pytest tests/test_health.py -v
```

### –§–∏–∫—Å—Ç—É—Ä—ã

```python
# tests/conftest.py –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç:

client          # –ù–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π HTTP-–∫–ª–∏–µ–Ω—Ç
auth_client     # –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π (—Å JWT-—Ç–æ–∫–µ–Ω–æ–º)
```

### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Ç–æ–∫–µ–Ω–∞

```python
from tests.conftest import create_test_token

# –û–±—ã—á–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
token = create_test_token()

# –°—É–ø–µ—Ä–∞–¥–º–∏–Ω
token = create_test_token(is_superadmin=True)

# –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
token = create_test_token(user_id=uuid.UUID("..."))
```

---

## üö¢ –î–µ–ø–ª–æ–π –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# Docker Compose: 3 –∏–Ω—Å—Ç–∞–Ω—Å–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
docker-compose up --scale community-app=3 -d
```

Nginx –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –±–∞–ª–∞–Ω—Å–∏—Ä—É–µ—Ç –Ω–∞–≥—Ä—É–∑–∫—É –º–µ–∂–¥—É –∏–Ω—Å—Ç–∞–Ω—Å–∞–º–∏
(—Å—Ç—Ä–∞—Ç–µ–≥–∏—è `least_conn`).

### –ü–æ—á–µ–º—É —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **Stateless API** ‚Äî –Ω–µ—Ç —Å–µ—Ä–≤–µ—Ä–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏
2. **UUID PK** ‚Äî –Ω–µ—Ç –∞–≤—Ç–æ–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞, –Ω–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤
3. **Shared Nothing** ‚Äî –∫–∞–∂–¥—ã–π –∏–Ω—Å—Ç–∞–Ω—Å –Ω–µ–∑–∞–≤–∏—Å–∏–º
4. **Connection Pooling** ‚Äî SQLAlchemy –ø—É–ª –Ω–∞ –∫–∞–∂–¥—ã–π –ø—Ä–æ—Ü–µ—Å—Å
5. **Redis** ‚Äî –æ–±—â–∏–π –∫—ç—à –¥–ª—è –≤—Å–µ—Ö –∏–Ω—Å—Ç–∞–Ω—Å–æ–≤

### Production Dockerfile

```dockerfile
# Multi-stage build
# –°—Ç–∞–¥–∏—è 1: —Å–±–æ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
FROM python:3.12-slim as builder
# ...

# –°—Ç–∞–¥–∏—è 2: runtime (–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–∑)
FROM python:3.12-slim
# –ù–µ–ø—Ä–∏–≤–∏–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (appuser)
# Health check –≤—Å—Ç—Ä–æ–µ–Ω
# Entrypoint: –º–∏–≥—Ä–∞—Ü–∏–∏ ‚Üí Gunicorn
```

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è Production

```env
DEBUG=false            # –û—Ç–∫–ª—é—á–∞–µ—Ç Swagger
WORKERS_COUNT=4        # CPU-bound –æ–ø—Ç–∏–º—É–º = 2 * CPU + 1
DB_POOL_SIZE=20        # –ü–æ–¥ –Ω–∞–≥—Ä—É–∑–∫—É
JWT_SECRET_KEY=<—Å–ª–æ–∂–Ω—ã–π —Å–ª—É—á–∞–π–Ω—ã–π –∫–ª—é—á>
```

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### Structured Logging

–ö–∞–∂–¥—ã–π –ª–æ–≥ ‚Äî JSON-–æ–±—ä–µ–∫—Ç, –≥–æ—Ç–æ–≤—ã–π –¥–ª—è ELK/Loki:

```json
{
  "timestamp": "2024-01-01T12:00:00.000Z",
  "level": "INFO",
  "logger": "app.services.community_service",
  "message": "–°–æ–æ–±—â–µ—Å—Ç–≤–æ —Å–æ–∑–¥–∞–Ω–æ",
  "service": "community-service",
  "version": "1.0.0",
  "user_id": "550e8400-...",
  "community_id": "660f9500-...",
  "action": "community_created",
  "duration_ms": 45.2,
  "request_id": "abc-123-def"
}
```

### X-Request-ID

–ö–∞–∂–¥—ã–π –æ—Ç–≤–µ—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∏:
```
X-Request-ID: abc-123-def
X-Response-Time: 45.2ms
```

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `X-Request-ID` –¥–ª—è —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –º–µ–∂–¥—É –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞–º–∏.

### Health Check

```bash
# Docker Health Check (–∫–∞–∂–¥—ã–µ 30 —Å–µ–∫)
curl http://localhost:8000/health
```

---

## üß† –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è ‚Äî –ø–æ—á–µ–º—É —Ç–∞–∫

### 1. –ü–æ—á–µ–º—É FastAPI, –∞ –Ω–µ Django/Flask?

| –ö—Ä–∏—Ç–µ—Ä–∏–π | FastAPI | Django REST | Flask |
|---|---|---|---|
| Async –∏–∑ –∫–æ—Ä–æ–±–∫–∏ | ‚úÖ | ‚ùå (ASGI-–∞–¥–∞–ø—Ç–µ—Ä) | ‚ùå |
| –ê–≤—Ç–æ–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è | ‚úÖ (Swagger) | ‚ùå (drf-yasg) | ‚ùå |
| –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å | üèÜ –í—ã—Å–æ–∫–∞—è | –°—Ä–µ–¥–Ω—è—è | –°—Ä–µ–¥–Ω—è—è |
| –í–∞–ª–∏–¥–∞—Ü–∏—è | Pydantic v2 | Serializers | –í—Ä—É—á–Ω—É—é |
| –¢–∏–ø–∏–∑–∞—Ü–∏—è | ‚úÖ –ù–∞—Ç–∏–≤–Ω–∞—è | –ß–∞—Å—Ç–∏—á–Ω–æ | ‚ùå |
| –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã | –ó–∞—Ç–æ—á–µ–Ω | –ú–æ–Ω–æ–ª–∏—Ç | –ü–æ–¥—Ö–æ–¥–∏—Ç |

**–í—ã–≤–æ–¥:** FastAPI ‚Äî –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π —Ñ—Ä–µ–π–º–≤–æ—Ä–∫, –≥–¥–µ async + –≤–∞–ª–∏–¥–∞—Ü–∏—è + –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
—Ä–∞–±–æ—Ç–∞—é—Ç –∏–∑ –∫–æ—Ä–æ–±–∫–∏ –±–µ–∑ –∫–æ–º–ø—Ä–æ–º–∏—Å—Å–æ–≤.

### 2. –ü–æ—á–µ–º—É SQLAlchemy 2.0 Async, –∞ –Ω–µ Tortoise/SQLModel?

- **–ó—Ä–µ–ª–æ—Å—Ç—å:** SQLAlchemy ‚Äî 20+ –ª–µ—Ç, –∫—Ä—É–ø–Ω–µ–π—à–∞—è ORM –≤ Python
- **Async 2.0:** –ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è async-–ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Å mapped_column
- **–ì–∏–±–∫–æ—Å—Ç—å:** –ú–æ–∂–Ω–æ –ø–∏—Å–∞—Ç—å raw SQL, –º–æ–∂–Ω–æ ORM
- **Alembic:** –ù–∞—Ç–∏–≤–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–π
- **Production-proven:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –∫—Ä—É–ø–Ω–µ–π—à–∏—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö

### 3. –ü–æ—á–µ–º—É —Ä—É—á–Ω–æ–π DI-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä, –∞ –Ω–µ dependency-injector?

```python
# –ù–∞—à –ø–æ–¥—Ö–æ–¥: –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å
class Container:
    def community_repo(self, session) -> CommunityRepository:
        return CommunityRepository(session)
```

- **–ù–µ—Ç –º–∞–≥–∏–∏** ‚Äî –∫–∞–∂–¥–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –≤–∏–¥–Ω–∞ —è–≤–Ω–æ
- **–ù–µ—Ç —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞** ‚Äî –Ω–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- **–õ–µ–≥–∫–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å** ‚Äî –ø–æ–¥–º–µ–Ω—è–µ–º –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –º–µ—Ç–æ–¥
- **–õ–µ–≥–∫–æ –ø–æ–Ω—è—Ç—å** ‚Äî –¥–∂—É–Ω–∏–æ—Ä —Ä–∞–∑–±–µ—Ä—ë—Ç—Å—è –∑–∞ 5 –º–∏–Ω—É—Ç

### 4. –ü–æ—á–µ–º—É UUID, –∞ –Ω–µ –∞–≤—Ç–æ–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç?

| UUID | Auto-increment |
|---|---|
| ‚úÖ –ì–ª–æ–±–∞–ª—å–Ω–æ —É–Ω–∏–∫–∞–ª–µ–Ω | ‚ùå –£–Ω–∏–∫–∞–ª–µ–Ω —Ç–æ–ª—å–∫–æ –≤ —Ç–∞–±–ª–∏—Ü–µ |
| ‚úÖ –ù–µ —É—Ç–µ–∫–∞–µ—Ç –ø–æ—Ä—è–¥–æ–∫ | ‚ùå –ú–æ–∂–Ω–æ –≤—ã—á–∏—Å–ª–∏—Ç—å –∫–æ–ª-–≤–æ –∑–∞–ø–∏—Å–µ–π |
| ‚úÖ –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ | ‚ùå –¢–æ–ª—å–∫–æ –ø–æ—Å–ª–µ INSERT |
| ‚úÖ –ë–µ–∑ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏–∏ –ø—Ä–∏ —à–∞—Ä–¥–∏–Ω–≥–µ | ‚ùå –ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã –ø—Ä–∏ merge |
| ‚ùå 16 –±–∞–π—Ç vs 8 –±–∞–π—Ç | ‚úÖ –ö–æ–º–ø–∞–∫—Ç–Ω–µ–µ |

–î–ª—è –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤ UUID ‚Äî —Å—Ç–∞–Ω–¥–∞—Ä—Ç –¥–µ-—Ñ–∞–∫—Ç–æ.

### 5. –ü–æ—á–µ–º—É Event Abstraction, –∞ –Ω–µ –Ω–∞–ø—Ä—è–º—É—é Kafka?

```python
class EventPublisher(ABC):
    async def publish(self, event, routing_key) -> None: ...

class KafkaEventPublisher(EventPublisher): ...
class RabbitMQEventPublisher(EventPublisher): ...
```

- **–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ** –æ–¥–Ω–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π (`EVENT_BROKER_TYPE=rabbitmq`)
- **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** ‚Äî –ø–æ–¥—Å—Ç–∞–≤–ª—è–µ–º mock-publisher
- **Stub-—Ä–µ–∂–∏–º** ‚Äî –µ—Å–ª–∏ Kafka/RabbitMQ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã, —Å–µ—Ä–≤–∏—Å –Ω–µ –ø–∞–¥–∞–µ—Ç
- **Open/Closed Principle** ‚Äî –¥–æ–±–∞–≤–∏—Ç—å NATS/SQS = –Ω–æ–≤—ã–π –∫–ª–∞—Å—Å, –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–¥–∞

### 6. –ü–æ—á–µ–º—É Redis Graceful Degradation?

```python
async def get(self, key: str):
    if not self._redis:
        return None  # –ù–µ—Ç Redis ‚Üí –∏–¥—ë–º –≤ –ë–î
    try:
        value = await self._redis.get(key)
        return json.loads(value) if value else None
    except Exception:
        return None  # –û—à–∏–±–∫–∞ Redis ‚Üí –∏–¥—ë–º –≤ –ë–î
```

Redis ‚Äî —ç—Ç–æ **–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è**, –∞ –Ω–µ **–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å**.
–ï—Å–ª–∏ Redis —É–ø–∞–ª ‚Üí latency —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è, –Ω–æ —Å–µ—Ä–≤–∏—Å —Ä–∞–±–æ—Ç–∞–µ—Ç.

### 7. –ü–æ—á–µ–º—É Pydantic v2 DTO, –∞ –Ω–µ SQLAlchemy –º–æ–¥–µ–ª–∏ –≤ –æ—Ç–≤–µ—Ç–∞—Ö?

```
Domain Model (SQLAlchemy) ‚Üê –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞, –º–æ–∂–µ—Ç –º–µ–Ω—è—Ç—å—Å—è
           ‚îÇ
           ‚ñº
Schema/DTO (Pydantic)    ‚Üê –ø—É–±–ª–∏—á–Ω—ã–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç API, —Å—Ç–∞–±–∏–ª—å–Ω—ã–π
```

- **Decoupling:** –ú–æ–¥–µ–ª—å –ë–î –∏ API-–∫–æ–Ω—Ç—Ä–∞–∫—Ç ‚Äî —Ä–∞–∑–Ω—ã–µ –≤–µ—â–∏
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** –ù–µ —É—Ç–µ–∫–∞—é—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–æ–ª—è (–ø–∞—Ä–æ–ª–∏, —Å–ª—É–∂–µ–±–Ω—ã–µ)
- **–í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ:** –ú–æ–∂–Ω–æ –∏–º–µ—Ç—å v1/v2 —Å—Ö–µ–º—ã –¥–ª—è –æ–¥–Ω–æ–π –º–æ–¥–µ–ª–∏
- **–í–∞–ª–∏–¥–∞—Ü–∏—è:** Pydantic v2 –±—ã—Å—Ç—Ä–µ–µ v1 –≤ ~5-17 —Ä–∞–∑

### 8. –ü–æ—á–µ–º—É session-per-request —á–µ—Ä–µ–∑ context manager?

```python
async with container.db_session() as session:
    service = CommunityService(
        community_repo=container.community_repo(session),
        ...
    )
    return await service.create_community(data, user)
    # ‚Üê –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π commit –∏–ª–∏ rollback
```

- **–ê—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å:** –í–µ—Å—å –∑–∞–ø—Ä–æ—Å –≤ –æ–¥–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- **–ù–µ—Ç —É—Ç–µ—á–µ–∫:** `finally: session.close()` –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω
- **–Ø–≤–Ω–æ—Å—Ç—å:** –í–∏–¥–Ω–æ, –≥–¥–µ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –∏ –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è

---

## üìö –ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∑–Ω–∞–Ω–∏—è

### –£—Ä–æ–≤–µ–Ω—å 1: –ú–∏–Ω–∏–º—É–º –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è –∫–æ–¥–∞

| –û–±–ª–∞—Å—Ç—å | –ß—Ç–æ –Ω—É–∂–Ω–æ –∑–Ω–∞—Ç—å |
|---|---|
| **Python 3.10+** | async/await, dataclasses, type hints, generics |
| **FastAPI** | –†–æ—É—Ç–µ—Ä—ã, dependencies, middleware, lifespan |
| **Pydantic v2** | BaseModel, Field, validators, ConfigDict |
| **SQLAlchemy 2.0** | mapped_column, relationship, select/insert/update |
| **PostgreSQL** | –¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö, –∏–Ω–¥–µ–∫—Å—ã, JSONB, ARRAY |
| **REST API** | HTTP-–º–µ—Ç–æ–¥—ã, —Å—Ç–∞—Ç—É—Å-–∫–æ–¥—ã, –ø–∞–≥–∏–Ω–∞—Ü–∏—è |

### –£—Ä–æ–≤–µ–Ω—å 2: –î–ª—è –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è

| –û–±–ª–∞—Å—Ç—å | –ß—Ç–æ –Ω—É–∂–Ω–æ –∑–Ω–∞—Ç—å |
|---|---|
| **Clean Architecture** | –°–ª–æ–∏—Å—Ç–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞, dependency inversion |
| **Repository Pattern** | –ê–±—Å—Ç—Ä–∞–∫—Ü–∏—è –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º |
| **RBAC** | –†–æ–ª–∏, —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è, –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞ |
| **JWT** | –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–æ–∫–µ–Ω–∞, Claims, –ø–æ–¥–ø–∏—Å—å |
| **Redis** | –ö–ª—é—á–∏, TTL, –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è, pub/sub |
| **Alembic** | –ú–∏–≥—Ä–∞—Ü–∏–∏, autogenerate, upgrade/downgrade |

### –£—Ä–æ–≤–µ–Ω—å 3: –î–ª—è production-–¥–µ–ø–ª–æ—è

| –û–±–ª–∞—Å—Ç—å | –ß—Ç–æ –Ω—É–∂–Ω–æ –∑–Ω–∞—Ç—å |
|---|---|
| **Docker** | Multi-stage build, compose, networking |
| **Kafka/RabbitMQ** | Topics, partitions, exchanges, routing |
| **Nginx** | Reverse proxy, upstream, load balancing |
| **Gunicorn** | Workers, pre-fork, timeout |
| **CI/CD** | GitHub Actions / GitLab CI |
| **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** | ELK, Prometheus, Grafana |
| **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** | OWASP, rate limiting, CORS |

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ —Ä–µ—Å—É—Ä—Å—ã

| –†–µ—Å—É—Ä—Å | –î–ª—è —á–µ–≥–æ |
|---|---|
| [FastAPI docs](https://fastapi.tiangolo.com/) | –û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è |
| [SQLAlchemy 2.0 Tutorial](https://docs.sqlalchemy.org/en/20/tutorial/) | –ù–æ–≤—ã–π —Å—Ç–∏–ª—å ORM |
| [Pydantic v2 docs](https://docs.pydantic.dev/latest/) | –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è |
| [Clean Architecture (Uncle Bob)](https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html) | –¢–µ–æ—Ä–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã |
| [12 Factor App](https://12factor.net/ru/) | –ü—Ä–∏–Ω—Ü–∏–ø—ã cloud-native |
| [Microservices Patterns (Chris Richardson)](https://microservices.io/patterns/) | –ü–∞—Ç—Ç–µ—Ä–Ω—ã –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤ |

---

## ‚ùì FAQ

### –ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é —Å—É—â–Ω–æ—Å—Ç—å?

1. **–ú–æ–¥–µ–ª—å:** `app/domain/models.py` ‚Äî –¥–æ–±–∞–≤–∏—Ç—å SQLAlchemy-–º–æ–¥–µ–ª—å
2. **–°—Ö–µ–º—ã:** `app/schemas/` ‚Äî Create/Update/Response DTO
3. **–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:** `app/repositories/` ‚Äî –Ω–∞—Å–ª–µ–¥–Ω–∏–∫ BaseRepository
4. **–°–µ—Ä–≤–∏—Å:** `app/services/` ‚Äî –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
5. **Router:** `app/api/v1/` ‚Äî endpoints
6. **Container:** –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–±—Ä–∏–∫—É —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
7. **Router:** –ø–æ–¥–∫–ª—é—á–∏—Ç—å –≤ `app/api/v1/router.py`
8. **–ú–∏–≥—Ä–∞—Ü–∏—è:** `alembic revision --autogenerate -m "add entity"`

### –ö–∞–∫ –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ RabbitMQ?

```env
EVENT_BROKER_TYPE=rabbitmq
RABBITMQ_URL=amqp://guest:guest@rabbitmq:5672/
```

### –ö–∞–∫ –æ—Ç–∫–ª—é—á–∏—Ç—å Swagger –≤ production?

```env
DEBUG=false
```

### –ö–∞–∫ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ 10 –∏–Ω—Å—Ç–∞–Ω—Å–æ–≤?

```bash
docker-compose up --scale community-app=10 -d
```

Nginx –≤ `docker/nginx.conf` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –±–∞–ª–∞–Ω—Å–∏—Ä—É–µ—Ç.

### –ö–∞–∫ –ø–æ–¥–∫–ª—é—á–∏—Ç—å –≤–Ω–µ—à–Ω–∏–π Auth Service?

–ó–∞–º–µ–Ω–∏—Ç–µ JWT-–¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ `app/core/security.py`:

```python
# –í–º–µ—Å—Ç–æ –ª–æ–∫–∞–ª—å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏
payload = jwt.decode(token, settings.JWT_SECRET_KEY, ...)

# –í—ã–∑–æ–≤ Auth Service
async with httpx.AsyncClient() as client:
    response = await client.post(
        f"{settings.AUTH_SERVICE_URL}/validate",
        headers={"Authorization": f"Bearer {token}"}
    )
    payload = response.json()
```

### –ì–¥–µ —Ö—Ä–∞–Ω–∏—Ç—å –º–µ–¥–∏–∞—Ñ–∞–π–ª—ã?

MinIO (S3-—Å–æ–≤–º–µ—Å—Ç–∏–º–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ) —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `S3Client`:

```python
url = await container.s3_client.upload_file(file_data, "avatars/user-123.jpg")
```

---

## ü§ù Contributing

1. Fork —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
2. –°–æ–∑–¥–∞–π—Ç–µ feature-–≤–µ—Ç–∫—É: `git checkout -b feature/my-feature`
3. Commit: `git commit -m "feat: add my feature"`
4. Push: `git push origin feature/my-feature`
5. Pull Request

### Code Style

- Python 3.12 type hints –≤–µ–∑–¥–µ
- Docstrings –Ω–∞ —Ä—É—Å—Å–∫–æ–º
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ —Å—Ç—Ä–æ–∫–∏: 120 —Å–∏–º–≤–æ–ª–æ–≤
- –ò–º–µ–Ω–æ–≤–∞–Ω–∏–µ: snake_case –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–π, PascalCase –¥–ª—è –∫–ª–∞—Å—Å–æ–≤

---

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License.




</div>
```
